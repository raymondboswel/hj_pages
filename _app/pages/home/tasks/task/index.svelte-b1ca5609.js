import{_ as s}from"../../../../chunks/preload-helper-9f12a5fd.js";import{S as e,i as t,s as a,e as l,t as n,k as r,c,a as o,g as i,d as f,n as h,b as u,f as m,F as g,h as d,G as p,z as v,_ as $,j as x,m as y,o as w,v as E,r as I,w as k,K as b,T as _,l as T,B as N,u as M,H as j,M as S,I as G,a4 as A,J as C,N as P,a5 as O}from"../../../../chunks/vendor-a8776545.js";import{P as D}from"../../../../chunks/PageTransition-3a35b110.js";import{h as L,c as R,t as U}from"../../../../chunks/task-api.service-ad79e11d.js";import{g as V}from"../../../../chunks/navigation-20968cc5.js";import"../../../../chunks/singletons-bb9012b7.js";function H(s){let e,t,a,v,$,x,y,w,E,I,k,b,_=s[0].text+"",T=`${s[2]}:${s[1]}`;return{c(){e=l("article"),t=l("section"),a=n(_),$=r(),x=l("section"),y=l("img"),E=r(),I=l("span"),k=n(T),this.h()},l(s){e=c(s,"ARTICLE",{class:!0});var l=o(e);t=c(l,"SECTION",{class:!0});var n=o(t);a=i(n,_),n.forEach(f),$=h(l),x=c(l,"SECTION",{class:!0});var r=o(x);y=c(r,"IMG",{class:!0,src:!0,alt:!0}),E=h(r),I=c(r,"SPAN",{});var u=o(I);k=i(u,T),u.forEach(f),r.forEach(f),l.forEach(f),this.h()},h(){u(t,"class",v="mx-5 px-5 py-3 "+(s[0].from_user?"user-message":"agent-message")+" svelte-1k7nd9w"),u(y,"class","rounded-full h-8 w-8"),y.src!==(w="https://placehold.co/400")&&u(y,"src","https://placehold.co/400"),u(y,"alt","avatar"),u(x,"class","rounded-full flex flex-col h-8 w-8"),u(e,"class",b="flex mx-5 my-2 justify-end "+(s[0].from_user?"flex-row":"flex-row-reverse"))},m(s,l){m(s,e,l),g(e,t),g(t,a),g(e,$),g(e,x),g(x,y),g(x,E),g(x,I),g(I,k)},p(s,[l]){1&l&&_!==(_=s[0].text+"")&&d(a,_),1&l&&v!==(v="mx-5 px-5 py-3 "+(s[0].from_user?"user-message":"agent-message")+" svelte-1k7nd9w")&&u(t,"class",v),1&l&&b!==(b="flex mx-5 my-2 justify-end "+(s[0].from_user?"flex-row":"flex-row-reverse"))&&u(e,"class",b)},i:p,o:p,d(s){s&&f(e)}}}function z(s,e,t){let{message:a}=e;const l=new Date(1e3*Number.parseInt(a.unix_timestamp)),n=l.getHours(),r=l.getMinutes(),c=r<10?`0${r}`:r,o=n<10?`0${n}`:n;return s.$$set=s=>{"message"in s&&t(0,a=s.message)},[a,c,o]}class F extends e{constructor(s){super(),t(this,s,z,H,a,{message:0})}}function B(s){let e,t;return{c(){e=l("img"),this.h()},l(s){e=c(s,"IMG",{src:!0,alt:!0}),this.h()},h(){e.src!==(t=s[1])&&u(e,"src",t),u(e,"alt","attachment")},m(s,t){m(s,e,t)},p(s,a){2&a&&e.src!==(t=s[1])&&u(e,"src",t)},d(s){s&&f(e)}}}function J(s){let e,t,a,d,v,$,x,y,w,E,I,k=`${s[3]}:${s[2]}`,b=null!=s[1]&&B(s);return{c(){e=l("article"),t=l("section"),b&&b.c(),d=r(),v=l("section"),$=l("img"),y=r(),w=l("span"),E=n(k),this.h()},l(s){e=c(s,"ARTICLE",{class:!0});var a=o(e);t=c(a,"SECTION",{class:!0});var l=o(t);b&&b.l(l),l.forEach(f),d=h(a),v=c(a,"SECTION",{class:!0});var n=o(v);$=c(n,"IMG",{class:!0,src:!0,alt:!0}),y=h(n),w=c(n,"SPAN",{});var r=o(w);E=i(r,k),r.forEach(f),n.forEach(f),a.forEach(f),this.h()},h(){u(t,"class",a="mx-5 px-5 py-3 "+(s[0].from_user?"user-message":"agent-message")+" svelte-1k7nd9w"),u($,"class","rounded-full h-8 w-8"),$.src!==(x="https://placehold.co/400")&&u($,"src","https://placehold.co/400"),u($,"alt","avatar"),u(v,"class","rounded-full flex flex-col h-8 w-8"),u(e,"class",I="flex mx-5 my-2 justify-end "+(s[0].from_user?"flex-row":"flex-row-reverse"))},m(s,a){m(s,e,a),g(e,t),b&&b.m(t,null),g(e,d),g(e,v),g(v,$),g(v,y),g(v,w),g(w,E)},p(s,[l]){null!=s[1]?b?b.p(s,l):(b=B(s),b.c(),b.m(t,null)):b&&(b.d(1),b=null),1&l&&a!==(a="mx-5 px-5 py-3 "+(s[0].from_user?"user-message":"agent-message")+" svelte-1k7nd9w")&&u(t,"class",a),1&l&&I!==(I="flex mx-5 my-2 justify-end "+(s[0].from_user?"flex-row":"flex-row-reverse"))&&u(e,"class",I)},i:p,o:p,d(s){s&&f(e),b&&b.d()}}}function K(s,e,t){let a,{message:l}=e;const n=new Date(1e3*Number.parseInt(l.unix_timestamp)),r=n.getHours(),c=n.getMinutes(),o=c<10?`0${c}`:c,i=r<10?`0${r}`:r;return v((()=>{console.log("downloading image",l.attachment_id),fetch("https://staging.heyjudeapp.com/api/v1/attachments/download/"+l.attachment_id,{method:"GET",headers:L.headers()}).then((s=>{try{my.postMessage("Got image, displaying")}catch(e){console.log(e)}s.blob().then((s=>{t(1,a=URL.createObjectURL(s))}))}))})),s.$$set=s=>{"message"in s&&t(0,l=s.message)},[l,a,o,i]}class q extends e{constructor(s){super(),t(this,s,K,J,a,{message:0})}}const Q=$(R,(s=>s?s.messages.reverse():[]));function W(s,e,t){const a=s.slice();return a[1]=e[t],a}function X(s){let e,t,a;return{c(){e=l("aside"),t=l("img"),this.h()},l(s){e=c(s,"ASIDE",{class:!0});var a=o(e);t=c(a,"IMG",{src:!0,alt:!0}),a.forEach(f),this.h()},h(){t.src!==(a=s[0])&&u(t,"src",a),u(t,"alt","attachment"),u(e,"class","absolute z-20 h-full w-full bg-black flex items-center")},m(s,a){m(s,e,a),g(e,t)},p(s,e){1&e&&t.src!==(a=s[0])&&u(t,"src",a)},d(s){s&&f(e)}}}function Y(s){let e,t;return e=new q({props:{message:s[1]}}),{c(){x(e.$$.fragment)},l(s){y(e.$$.fragment,s)},m(s,a){w(e,s,a),t=!0},p(s,t){const a={};64&t&&(a.message=s[1]),e.$set(a)},i(s){t||(E(e.$$.fragment,s),t=!0)},o(s){I(e.$$.fragment,s),t=!1},d(s){k(e,s)}}}function Z(s){let e,t;return e=new F({props:{message:s[1]}}),{c(){x(e.$$.fragment)},l(s){y(e.$$.fragment,s)},m(s,a){w(e,s,a),t=!0},p(s,t){const a={};64&t&&(a.message=s[1]),e.$set(a)},i(s){t||(E(e.$$.fragment,s),t=!0)},o(s){I(e.$$.fragment,s),t=!1},d(s){k(e,s)}}}function ss(s,e){let t,a,l,n,r;const c=[Z,Y],o=[];function i(s,e){return"text"==s[1].type?0:"image"==s[1].type?1:-1}return~(a=i(e))&&(l=o[a]=c[a](e)),{key:s,first:null,c(){t=T(),l&&l.c(),n=T(),this.h()},l(s){t=T(),l&&l.l(s),n=T(),this.h()},h(){this.first=t},m(s,e){m(s,t,e),~a&&o[a].m(s,e),m(s,n,e),r=!0},p(s,t){let r=a;a=i(e=s),a===r?~a&&o[a].p(e,t):(l&&(N(),I(o[r],1,1,(()=>{o[r]=null})),M()),~a?(l=o[a],l?l.p(e,t):(l=o[a]=c[a](e),l.c()),E(l,1),l.m(n.parentNode,n)):l=null)},i(s){r||(E(l),r=!0)},o(s){I(l),r=!1},d(s){s&&f(t),~a&&o[a].d(s),s&&f(n)}}}function es(s){let e,t,a,n;return{c(){e=l("img"),this.h()},l(s){e=c(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){u(e,"class","h-10 m-2"),e.src!==(t="/images/send_button.svg")&&u(e,"src","/images/send_button.svg"),u(e,"alt","send button")},m(t,l){m(t,e,l),a||(n=G(e,"click",s[8]),a=!0)},p:p,i:p,o:p,d(s){s&&f(e),a=!1,n()}}}function ts(s){let e,t,a;var l=s[2];return l&&(e=new l({props:{width:40,height:40}})),{c(){e&&x(e.$$.fragment),t=T()},l(s){e&&y(e.$$.fragment,s),t=T()},m(s,l){e&&w(e,s,l),m(s,t,l),a=!0},p(s,a){if(l!==(l=s[2])){if(e){N();const s=e;I(s.$$.fragment,1,0,(()=>{k(s,1)})),M()}l?(e=new l({props:{width:40,height:40}}),x(e.$$.fragment),E(e.$$.fragment,1),w(e,t.parentNode,t)):e=null}},i(s){a||(e&&E(e.$$.fragment,s),a=!0)},o(s){e&&I(e.$$.fragment,s),a=!1},d(s){s&&f(t),e&&k(e,s)}}}function as(s){var e;let t,a,p,v,$,x,y,w,k,b,_,T,P,D,L,R,U,V,H,z,F,B,J,K,q,Q,Y=(null==(e=s[5])?void 0:e.title)+"",Z=[],as=new Map,ls=s[0]&&X(s),ns=s[6];const rs=s=>s[1].id;for(let l=0;l<ns.length;l+=1){let e=W(s,ns,l),t=rs(e);as.set(t,Z[l]=ss(t,e))}const cs=[ts,es],os=[];function is(s,e){return s[3]?0:1}return B=is(s),J=os[B]=cs[B](s),{c(){t=l("article"),a=l("section"),p=l("span"),v=l("img"),x=r(),y=l("span"),w=n(Y),k=r(),b=l("section"),ls&&ls.c(),_=r();for(let s=0;s<Z.length;s+=1)Z[s].c();T=r(),P=l("section"),D=l("div"),L=l("img"),U=r(),V=l("div"),H=l("input"),z=r(),F=l("div"),J.c(),this.h()},l(s){t=c(s,"ARTICLE",{class:!0});var e=o(t);a=c(e,"SECTION",{class:!0});var l=o(a);p=c(l,"SPAN",{class:!0,style:!0});var n=o(p);v=c(n,"IMG",{class:!0,src:!0,alt:!0}),n.forEach(f),x=h(l),y=c(l,"SPAN",{class:!0});var r=o(y);w=i(r,Y),r.forEach(f),l.forEach(f),k=h(e),b=c(e,"SECTION",{class:!0});var u=o(b);ls&&ls.l(u),_=h(u);for(let t=0;t<Z.length;t+=1)Z[t].l(u);u.forEach(f),T=h(e),P=c(e,"SECTION",{class:!0});var m=o(P);D=c(m,"DIV",{class:!0});var g=o(D);L=c(g,"IMG",{class:!0,src:!0,alt:!0}),g.forEach(f),U=h(m),V=c(m,"DIV",{class:!0});var d=o(V);H=c(d,"INPUT",{class:!0,placeholder:!0}),d.forEach(f),z=h(m),F=c(m,"DIV",{style:!0});var $=o(F);J.l($),$.forEach(f),m.forEach(f),e.forEach(f),this.h()},h(){u(v,"class","h-5"),v.src!==($="/images/chevron-right.svg")&&u(v,"src","/images/chevron-right.svg"),u(v,"alt","back"),u(p,"class","chevron-left svelte-1kfu1s7"),j(p,"left","10px"),j(p,"position","absolute"),u(y,"class","text-white font-bold text-xl"),u(a,"class","bg-blue flex justify-center text-center py-2 relative"),u(b,"class","flex-grow h-full flex flex-col-reverse  overflow-y-auto relative"),u(L,"class","h-9 mx-4 "),L.src!==(R="/images/image.svg")&&u(L,"src","/images/image.svg"),u(L,"alt","attachment"),u(D,"class","border-r p-2"),u(H,"class","w-full"),u(H,"placeholder","Message..."),u(V,"class","flex-grow ml-2"),j(F,"opacity",s[4]?1:.4),u(P,"class","flex h-14 border-t items-center"),u(t,"class","flex flex-col h-screen overflow-hidden relative")},m(e,l){m(e,t,l),g(t,a),g(a,p),g(p,v),g(a,x),g(a,y),g(y,w),g(t,k),g(t,b),ls&&ls.m(b,null),g(b,_);for(let s=0;s<Z.length;s+=1)Z[s].m(b,null);g(t,T),g(t,P),g(P,D),g(D,L),g(P,U),g(P,V),g(V,H),S(H,s[1]),g(P,z),g(P,F),os[B].m(F,null),K=!0,q||(Q=[G(p,"click",s[7]),G(L,"click",s[9]),G(H,"input",s[12])],q=!0)},p(s,e){var t;(!K||32&e)&&Y!==(Y=(null==(t=s[5])?void 0:t.title)+"")&&d(w,Y),s[0]?ls?ls.p(s,e):(ls=X(s),ls.c(),ls.m(b,_)):ls&&(ls.d(1),ls=null),64&e&&(ns=s[6],N(),Z=A(Z,e,rs,1,s,ns,as,b,O,ss,null,W),M()),2&e&&H.value!==s[1]&&S(H,s[1]);let a=B;B=is(s),B===a?os[B].p(s,e):(N(),I(os[a],1,1,(()=>{os[a]=null})),M(),J=os[B],J?J.p(s,e):(J=os[B]=cs[B](s),J.c()),E(J,1),J.m(F,null)),(!K||16&e)&&j(F,"opacity",s[4]?1:.4)},i(s){if(!K){for(let s=0;s<ns.length;s+=1)E(Z[s]);E(J),K=!0}},o(s){for(let e=0;e<Z.length;e+=1)I(Z[e]);I(J),K=!1},d(s){s&&f(t),ls&&ls.d();for(let e=0;e<Z.length;e+=1)Z[e].d();os[B].d(),q=!1,C(Q)}}}function ls(s){let e,t;return e=new D({props:{direction:"x",$$slots:{default:[as]},$$scope:{ctx:s}}}),{c(){x(e.$$.fragment)},l(s){y(e.$$.fragment,s)},m(s,a){w(e,s,a),t=!0},p(s,[t]){const a={};524415&t&&(a.$$scope={dirty:t,ctx:s}),e.$set(a)},i(s){t||(E(e.$$.fragment,s),t=!0)},o(s){I(e.$$.fragment,s),t=!1},d(s){k(e,s)}}}function ns(e,t,a){let l,n,r,c;b(e,R,(s=>a(5,r=s))),b(e,Q,(s=>a(6,c=s)));var o=this&&this.__awaiter||function(s,e,t,a){return new(t||(t=Promise))((function(l,n){function r(s){try{o(a.next(s))}catch(e){n(e)}}function c(s){try{o(a.throw(s))}catch(e){n(e)}}function o(s){var e;s.done?l(s.value):(e=s.value,e instanceof t?e:new t((function(s){s(e)}))).then(r,c)}o((a=a.apply(s,e||[])).next())}))};let i,f="",h="",u=!1,m=!1;return v((()=>{s((()=>import("../../../../chunks/Lottie-f609c826.js")),["/_app/chunks/Lottie-f609c826.js","/_app/assets/Lottie-257fbc6b.css","/_app/chunks/vendor-a8776545.js"]).then((s=>{a(2,i=s.default)}));let e=P(R);console.log("Got task",e),e||V("/home/tasks/list/active");try{my.onMessage=function(s){return o(this,void 0,void 0,(function*(){if("uploadingStatus"==s.type){const t=s.attachmentId;yield U.messageAttachmentTask(e.id,t),yield U.getTask(e.id).then((s=>{R.set(s.data.task)})),a(11,m=!1)}}))}}catch(t){}})),_((()=>{try{my.onMessage=function(s){}}catch(s){}})),e.$$.update=()=>{3072&e.$$.dirty&&a(3,l=u||m),3&e.$$.dirty&&a(4,n=f.length>0||null!=h)},[h,f,i,l,n,r,c,function(){h?a(0,h=void 0):history.back()},function(){h&&(a(11,m=!0),my.postMessage({type:"uploadImage",uploadImageUrl:h})),f.length>0&&function(){o(this,void 0,void 0,(function*(){const s=P(R);a(10,u=!0);try{yield U.messageTask(s.id,f),yield U.getTask(s.id).then((s=>{R.set(s.data.task)}))}catch(e){console.log(e)}finally{a(10,u=!1),a(1,f="")}}))}()},function(){my.chooseImage({count:1,success:s=>{a(0,h=s.apFilePaths[0])}})},u,m,function(){f=this.value,a(1,f)}]}export default class extends e{constructor(s){super(),t(this,s,ns,ls,a,{})}}
